<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes" />
<title>Aplikasi Pembuat Surat Sekolah - MA Ash-Shidiqi</title>
<!-- Google Fonts: Poppins -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- Font Awesome for Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

<style>
  :root {
    --primary-dark: #0a4d2f;
    --primary: #0b5a3a;
    --primary-light: #7fc49b;
    --secondary: #f0f9f4;
    --background: #eef7f1;
    --surface: #ffffff;
    --text-primary: #212121;
    --text-secondary: #555555;
    --text-muted: #888888;
    --error: #d32f2f;
    --border: #e0e0e0;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-hover: 0 8px 24px rgba(0, 0, 0, 0.12);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: "Poppins", sans-serif;
    background-color: var(--background);
    color: var(--text-primary);
    line-height: 1.6;
  }

  .app {
    display: flex;
    min-height: 100vh;
  }

  /* SIDEBAR */
  .sidebar {
    width: 380px;
    background: linear-gradient(180deg, var(--primary-dark), var(--primary));
    color: var(--surface);
    padding: 25px;
    overflow-y: auto;
    box-shadow: var(--shadow);
  }

  .brand {
    font-weight: 700;
    font-size: 20px;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .sidebar p.sub {
    opacity: 0.9;
    font-size: 13px;
    margin-bottom: 25px;
  }

  .menu {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 25px;
  }

  .menu .section-title {
    font-size: 13px;
    font-weight: 600;
    opacity: 0.9;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  select, input, textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid var(--border);
    border-radius: 8px;
    font-family: inherit;
    font-size: 14px;
    transition: border-color 0.3s, box-shadow 0.3s;
    background-color: var(--surface);
    color: var(--text-primary);
  }

  select:focus, input:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-light);
    box-shadow: 0 0 0 3px rgba(127, 196, 155, 0.2);
  }
  
  .form-group {
    margin-bottom: 15px;
    position: relative;
  }
  .form-group label {
    display: block;
    font-weight: 500;
    margin-bottom: 5px;
    font-size: 13px;
  }
  .form-group .error-message {
    color: var(--error);
    font-size: 12px;
    margin-top: 4px;
    display: none;
  }
  .form-group.has-error input,
  .form-group.has-error textarea,
  .form-group.has-error select {
    border-color: var(--error);
    background-color: rgba(211, 47, 47, 0.05);
  }
  .form-group.has-error .error-message {
    display: block;
  }
  
  /* Required field indicator */
  label.required::after {
    content: " *";
    color: var(--error);
    font-weight: bold;
  }

  /* CONTENT */
  .content {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
  }

  .panel {
    background: var(--surface);
    border-radius: 12px;
    padding: 25px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    height: calc(100vh - 60px);
  }

  .panel-header {
    display: flex;
    align-items: center;
    padding: 15px;
    background: var(--primary-light);
    border-radius: 10px;
    margin-bottom: 20px;
    gap: 20px;
  }
  .panel h3 {
    margin: 0;
    color: var(--primary);
    font-weight: 600;
  }

  .preview-actions {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .btn {
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    border: 0;
    font-weight: 500;
    font-size: 14px;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .btn-prim {
    background: var(--primary);
    color: var(--surface);
  }
  .btn-prim:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
  }
  
  .btn-outline {
    background-color: rgba(255, 255, 255, 0.1);
    border: 1px solid var(--primary);
    color: var(--primary);
  }
  .btn-outline:hover {
    background-color: rgba(11, 90, 58, 0.1);
    border-color: var(--primary-dark);
    color: var(--primary-dark);
  }

  /* Form Container */
  .form-container {
    background-color: var(--secondary);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 20px;
    border: 1px solid var(--primary-light);
  }
  .hidden {
    display: none;
  }

  /* Preview Container */
  .preview-container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    justify-content: center;
  }

  /* PREVIEW (kertas legal) */
  .preview-wrap {
    flex-grow: 1;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .preview {
    background: #fdfdf8;
    width: 21.59cm;
    min-height: 35.56cm;
    margin: 0 auto 30px auto;
    padding: 1.5cm 2.5cm 2cm 2.5cm;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    position: relative;
    text-align: left;
    page-break-after: always;
  }

  .paper {
    font-family: "Times New Roman", Times, serif;
    font-size: 12pt;
    line-height: 1.5;
    color: #000;
    position: relative;
    z-index: 1;
  }

  /* Kop Surat Baru - YAYASAN ASH SHIDIQI MATARAM BARU */
  .letterhead {
    display: flex;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 2px solid #000;
    padding-bottom: 15px;
  }
  .letterhead .logo-placeholder {
    width: 80px;
    height: 80px;
    background: #ddd;
    margin-right: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 40px;
    color: #777;
    overflow: hidden;
    flex-shrink: 0;
    border-radius: 0;
  }
  .letterhead .logo-placeholder img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .letterhead .letterhead-text {
    flex: 1;
    text-align: center;
  }
  .letterhead .letterhead-text p {
    margin: 2px 0;
    line-height: 1.3;
    font-weight: bold;
  }
  .letterhead h1 { 
    margin: 0; 
    font-size: 20px; 
    font-weight: bold; 
    text-transform: uppercase;
  }
  .letterhead .yayasan {
    font-size: 16px;
    letter-spacing: 1px;
  }
  .letterhead .sekolah {
    font-size: 18px;
    margin: 5px 0;
  }
  .letterhead .alamat {
    font-size: 10px;
    font-style: italic;
    margin-top: 8px;
    font-weight: normal;
  }

  .paper .center { text-align: center; }
  .paper .u { text-decoration: underline; }
  .paper .indent { text-indent: 50px; }
  .paper .justify { text-align: justify; }
  
  /* Styling untuk tabel tanpa garis */
  .paper table.tanpa-garis {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0 20px 0;
    border: none;
  }
  
  .paper table.tanpa-garis th,
  .paper table.tanpa-garis td {
    border: none;
    padding: 8px;
    text-align: left;
    vertical-align: top;
    line-height: 1.5;
  }
  
  /* Tabel 3 kolom tanpa garis untuk bagian menimbang dan mengingat */
  .paper table.tiga-kolom {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0 20px 0;
    border: none;
  }
  
  .paper table.tiga-kolom td {
    border: none;
    padding: 5px 8px;
    vertical-align: top;
    line-height: 1.5;
  }
  
  .paper table.tiga-kolom td:first-child {
    width: 20%;
    font-weight: bold;
    white-space: nowrap;
  }
  
  .paper table.tiga-kolom td:nth-child(2) {
    width: 5%;
    text-align: center;
    white-space: nowrap;
  }
  
  .paper table.tiga-kolom td:nth-child(3) {
    width: 75%;
    text-align: justify;
  }
  
  /* Tabel dengan garis untuk Lampiran */
  .paper table.dengan-garis {
    width: 100%;
    border-collapse: collapse;
    margin: 10px 0 20px 0;
    border: 1px solid #000;
  }
  
  .paper table.dengan-garis th,
  .paper table.dengan-garis td {
    border: 1px solid #000;
    padding: 8px;
    text-align: center;
    line-height: 1.5;
  }
  
  .paper table.dengan-garis th {
    background-color: #f2f2f2;
    font-weight: bold;
  }
  
  /* Logo Upload */
  .logo-upload {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
  }
  .logo-preview {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: #ddd;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    flex-shrink: 0;
  }
  .logo-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  .logo-upload-btn {
    padding: 8px 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    color: white;
    cursor: pointer;
    font-size: 13px;
    transition: all 0.3s;
  }
  .logo-upload-btn:hover {
    background: rgba(255, 255, 255, 0.2);
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .sidebar { width: 320px; }
    .preview { 
      transform: scale(0.7); 
      transform-origin: top center; 
      margin-bottom: -20%; 
      width: 21.59cm;
      height: auto;
    }
  }
  @media (max-width: 1000px) {
    .app { flex-direction: column; }
    .sidebar { width: 100%; }
    .content { padding: 15px; }
    .panel { height: auto; }
    .preview { 
      transform: none; 
      width: 100%; 
      padding: 1cm;
      min-height: auto;
      margin: 0 auto; 
    }
  }
  @media (max-width: 768px) {
    .panel-header { flex-direction: column; align-items: flex-start; }
    .preview-actions { width: 100%; justify-content: flex-start; }
    .preview { padding: 0.8cm; }
  }

  /* Tab Navigation */
  .tab-navigation {
    display: flex;
    border-bottom: 1px solid var(--border);
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  
  .tab-button {
    padding: 10px 20px;
    background: none;
    border: none;
    border-bottom: 3px solid transparent;
    cursor: pointer;
    font-weight: 500;
    color: var(--text-secondary);
    transition: all 0.3s;
  }
  
  .tab-button.active {
    color: var(--primary);
    border-bottom-color: var(--primary);
  }
  
  .tab-button:hover {
    color: var(--primary);
  }
  
  .tab-content {
    display: none;
  }
  
  .tab-content.active {
    display: block;
  }
  
  /* Dynamic Row Styles */
  .dynamic-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    flex-wrap: wrap;
  }
  
  .dynamic-row input {
    flex: 1 1 150px;
    min-width: 120px;
  }
  
  .remove-row-btn {
    background: var(--error);
    color: white;
    border: none;
    border-radius: 4px;
    width: 36px;
    height: 36px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  .add-row-btn {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 4px;
    padding: 8px 16px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    margin-top: 10px;
  }

  /* ============ TANDA TANGAN DI KANAN BAWAH (SURAT RESMI) ============ */
  .signature-right-container {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    width: 100%;
    margin-top: 40px;
  }
  
  .tempat-tanggal-kanan {
    text-align: left;
    width: 50%;
    margin-bottom: 10px;
    margin-right: 0;
  }
  
  .tempat-tanggal-kanan p {
    margin: 0;
    line-height: 1.5;
    text-align: left;
  }
  
  .penandatanganan-kanan {
    text-align: center;
    width: 50%;
    margin-top: 0;
  }
  
  .penandatanganan-kanan p {
    margin: 0;
    line-height: 1.5;
  }
  
  .penandatanganan-kanan .jabatan {
    margin-bottom: 5px;
  }
  
  .penandatanganan-kanan .nama {
    margin-top: 15px;
    margin-bottom: 2px;
  }
  
  .penandatanganan-kanan .nip {
    margin-top: 2px;
  }
  /* ================================================================ */
  
  /* Judul Lampiran di kiri atas */
  .lampiran-header {
    text-align: left;
    margin-bottom: 20px;
  }
  
  .lampiran-header h3 {
    text-decoration: underline;
    margin-bottom: 5px;
    font-size: 14pt;
  }
  
  .lampiran-header p {
    margin: 2px 0;
    line-height: 1.4;
  }

  /* Print button */
  .print-btn {
    background: #4CAF50;
    color: white;
  }
  .print-btn:hover {
    background: #45a049;
  }
  
  /* Loading spinner */
  .loading {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: white;
    animation: spin 1s ease-in-out infinite;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  /* Fieldset styling */
  fieldset {
    border: 1px solid var(--primary-light);
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
  }
  
  legend {
    font-weight: 600;
    color: var(--primary-dark);
    padding: 0 10px;
  }
  
  /* Notification */
  .notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--primary);
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: var(--shadow-hover);
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
  }
  
  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
</style>
</head>
<body>

<div class="app">
  <aside class="sidebar">
    <div class="brand">
      <i class="fas fa-school"></i> MA Ash-Shidiqi
    </div>
    <p class="sub">Aplikasi Pembuatan Surat Sekolah</p>
    
    <div class="menu">
      <div class="section-title">Identitas Sekolah</div>
      <div class="logo-upload">
        <div class="logo-preview" id="logoPreview">
          <i class="fas fa-school" style="color: #999;"></i>
        </div>
        <div>
          <input type="file" id="logoInput" accept="image/*" style="display: none;">
          <button type="button" class="logo-upload-btn" onclick="document.getElementById('logoInput').click()">
            <i class="fas fa-upload"></i> Upload Logo
          </button>
          <button type="button" class="logo-upload-btn" onclick="removeLogo()" style="margin-left: 5px; background: rgba(211, 47, 47, 0.3);">
            <i class="fas fa-times"></i> Hapus
          </button>
        </div>
      </div>
      
      <div class="form-group">
        <label for="yayasan" class="required">Yayasan</label>
        <input id="yayasan" type="text" placeholder="YAYASAN ASH SHIDIQI MATARAM BARU" value="YAYASAN ASH SHIDIQI MATARAM BARU" oninput="updateAllPreviews()">
        <span class="error-message">Yayasan harus diisi.</span>
      </div>
      
      <div class="form-group">
        <label for="nama_sekolah" class="required">Nama Sekolah</label>
        <input id="nama_sekolah" type="text" placeholder="MA. ASH-SHIDIQI RAJABASA BARU" value="MA. ASH-SHIDIQI RAJABASA BARU" oninput="updateAllPreviews()" required>
        <span class="error-message">Nama sekolah harus diisi.</span>
      </div>
	  
      <div class="form-group">
        <label for="kecamatan" class="required">Kecamatan</label>
        <input id="kecamatan" type="text" placeholder="MATARAM BARU" value="MATARAM BARU" oninput="updateAllPreviews()" required>
        <span class="error-message">Kecamatan harus diisi.</span>
      </div>
      
      <div class="form-group">
        <label for="kabupaten" class="required">Kabupaten</label>
        <input id="kabupaten" type="text" placeholder="LAMPUNG TIMUR" value="LAMPUNG TIMUR" oninput="updateAllPreviews()" required>
        <span class="error-message">Kabupaten harus diisi.</span>
      </div>
      
      <div class="form-group">
        <label for="alamat_lengkap">Alamat Lengkap</label>
        <textarea id="alamat_lengkap" rows="2" placeholder="Srirejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199" oninput="updateAllPreviews()">Srirejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199</textarea>
      </div>
     
      <div class="form-group">
        <label for="nama_kepala_sekolah" class="required">Nama Kepala Sekolah</label>
        <input id="nama_kepala_sekolah" type="text" placeholder="Nama Kepala Sekolah" oninput="updateAllPreviews()" required>
        <span class="error-message">Nama kepala sekolah harus diisi.</span>
      </div>
      
      <div class="form-group">
        <label for="tempat_ttd" class="required">Tempat Penandatanganan</label>
        <input id="tempat_ttd" type="text" value="Rajabasa Baru" oninput="updateAllPreviews()" required>
        <span class="error-message">Tempat penandatanganan harus diisi.</span>
      </div>
      
      <div class="form-group">
        <label for="nip_kepala_sekolah">NIP Kepala Sekolah</label>
        <input id="nip_kepala_sekolah" type="text" placeholder="NIP. ................................." oninput="updateAllPreviews()">
      </div>
      
      <button type="button" class="btn btn-prim" style="width: 100%; margin-top: 10px;" onclick="saveIdentitasSekolah()">
        <i class="fas fa-save"></i> Simpan Identitas Sekolah
      </button>
    </div>
  </aside>

  <main class="content">
    <div class="panel">
      <div class="panel-header">
        <div style="flex: 1;">
          <select id="jenisSurat" onchange="handleJenisSuratChange()" style="width: 100%; max-width: 360px; padding: 10px;">
            <option value="sk_keputusan">1. Surat Keputusan Kepala Sekolah</option>
            <option value="sk_panitia">2. SK Panitia</option>
            <option value="surat_edaran">3. Surat Edaran Biaya Sekolah</option>
            <option value="surat_pemanggilan">4. Surat Pemanggilan Orang Tua/Wali Siswa</option>
          </select>
        </div>
        <div class="preview-actions">
          <button type="button" class="btn btn-outline" onclick="toggleForm()">
            <i class="fas fa-edit"></i> <span id="toggleFormText">Buat Surat</span>
          </button>
          <button type="button" class="btn print-btn" onclick="printDocument()">
            <i class="fas fa-print"></i> Cetak
          </button>
        </div>
      </div>

      <div id="formContainer" class="form-container hidden">
        <div id="dynamicFormContent">
          <!-- Form akan diisi berdasarkan jenis surat -->
        </div>
      </div>

      <div class="preview-wrap">
        <div class="preview-container" id="previewContainer">
          <!-- Preview akan diisi berdasarkan jenis surat -->
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal Konfirmasi Cetak -->
<div id="printModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
  <div style="background: white; padding: 30px; border-radius: 10px; max-width: 500px; width: 90%;">
    <h3 style="margin-bottom: 20px; color: var(--primary);">Konfirmasi Cetak</h3>
    <p style="margin-bottom: 15px;">Pilih opsi cetak:</p>
    
    <div style="display: flex; gap: 10px; flex-direction: column; margin-bottom: 20px;">
      <button type="button" class="btn btn-prim" onclick="printAllPreviews(true)">
        <i class="fas fa-print"></i> Cetak Preview di Browser
      </button>
    </div>
    
    <div style="display: flex; gap: 10px; justify-content: flex-end;">
      <button type="button" class="btn btn-outline" onclick="hidePrintModal()">Batal</button>
    </div>
  </div>
</div>

<script>
// --- GLOBAL STATE & CONFIG ---
let currentJenisSurat = 'sk_keputusan';
const IDENTITAS_KEY = 'identitasSekolah';
let debounceTimer;
let logoDataUrl = null;
let guruData = []; // Untuk SK Keputusan
let pengawasData = []; // Untuk SK Panitia
let biayaData = []; // Untuk Surat Edaran
let pemanggilanData = {}; // Untuk Surat Pemanggilan

// --- FORM TEMPLATES ---
const formTemplates = {
  sk_keputusan: `
    <div class="tab-navigation">
      <button type="button" class="tab-button active" onclick="showTab(1)">Data Utama SK</button>
      <button type="button" class="tab-button" onclick="showTab(2)">Lampiran 1 - Pembagian Tugas</button>
      <button type="button" class="tab-button" onclick="showTab(3)">Lampiran 2 - Tugas Tambahan</button>
    </div>
    
    <div id="tab1" class="tab-content active">
      <form id="suratForm">
        <fieldset>
          <legend>Data Surat Keputusan</legend>
          <div style="display: flex; gap: 16px; margin-bottom: 15px; flex-wrap: wrap;">
            <div style="flex: 1 1 200px;">
              <div class="form-group">
                <label for="nomor_surat" class="required">Nomor Surat</label>
                <input id="nomor_surat" type="text" placeholder="Contoh: 001/SK-KS/IX/2023" oninput="updatePreview()" required>
                <span class="error-message">Nomor surat harus diisi.</span>
              </div>
            </div>
            <div style="flex: 1 1 200px;">
              <div class="form-group">
                <label for="tanggal_surat" class="required">Tanggal Surat</label>
                <input id="tanggal_surat" type="text" placeholder="Contoh: 25 Oktober 2023" oninput="updatePreview()" required>
                <span class="error-message">Tanggal surat harus diisi.</span>
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 16px; margin-bottom: 15px;">
            <div style="flex: 1;">
              <div class="form-group">
                <label for="tahun_pelajaran" class="required">Tahun Pelajaran</label>
                <input id="tahun_pelajaran" type="text" placeholder="Contoh: 2023/2024" oninput="updatePreview()" required>
                <span class="error-message">Tahun pelajaran harus diisi.</span>
              </div>
            </div>
          </div>
        </fieldset>
      </form>
    </div>
    
    <div id="tab2" class="tab-content">
      <h4>Pembagian Tugas Guru dan Tenaga Kependidikan</h4>
      <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 15px;">Isi data pembagian tugas mengajar untuk lampiran 1</p>
      
      <div id="guruTableContainer">
        <!-- Dynamic rows will be added here -->
      </div>
      
      <button type="button" class="add-row-btn" onclick="addGuruRow()">
        <i class="fas fa-plus"></i> Tambah Guru
      </button>
    </div>
    
    <div id="tab3" class="tab-content">
      <h4>Pembagian Tugas Tambahan Guru</h4>
      <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 15px;">Isi data tugas tambahan untuk lampiran 2</p>
      
      <div style="margin-left: 20px;">
        <div class="form-group">
          <label for="kepala_madrasah">KEPALA MADRASAH:</label>
          <input id="kepala_madrasah" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="waka_kurikulum">WAKA. KURIKULUM:</label>
          <input id="waka_kurikulum" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="waka_kesiswaan">WAKA. KESISWAAN:</label>
          <input id="waka_kesiswaan" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="bendahara">BENDAHARA:</label>
          <input id="bendahara" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="humas">HUMAS:</label>
          <input id="humas" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="sarpras">SARPRAS:</label>
          <input id="sarpras" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="wali_kelas_x">WALI KELAS X:</label>
          <input id="wali_kelas_x" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="wali_kelas_xi">WALI KELAS XI:</label>
          <input id="wali_kelas_xi" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="wali_kelas_xii">WALI KELAS XII:</label>
          <input id="wali_kelas_xii" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="operator">OPERATOR:</label>
          <input id="operator" type="text" oninput="updatePreview()">
        </div>
        <div class="form-group">
          <label for="tata_usaha">TATA USAHA:</label>
          <input id="tata_usaha" type="text" oninput="updatePreview()">
        </div>
      </div>
    </div>
  `,
  
  sk_panitia: `
    <div class="tab-navigation">
      <button type="button" class="tab-button active" onclick="showTabPanitia(1)">Data Utama SK Panitia</button>
      <button type="button" class="tab-button" onclick="showTabPanitia(2)">Lampiran 1 - Susunan Panitia</button>
      <button type="button" class="tab-button" onclick="showTabPanitia(3)">Lampiran 2 - Daftar Pengawas</button>
    </div>
    
    <div id="tabPanitia1" class="tab-content active">
      <form id="suratForm">
        <fieldset>
          <legend>Data Surat Keputusan Panitia</legend>
          <div style="display: flex; gap: 16px; margin-bottom: 15px; flex-wrap: wrap;">
            <div style="flex: 1 1 200px;">
              <div class="form-group">
                <label for="nomor_surat_panitia" class="required">Nomor Surat</label>
                <input id="nomor_surat_panitia" type="text" placeholder="Contoh: 002/SK-PAN/IX/2023" oninput="updatePreview()" required>
                <span class="error-message">Nomor surat harus diisi.</span>
              </div>
            </div>
            <div style="flex: 1 1 200px;">
              <div class="form-group">
                <label for="tanggal_surat_panitia" class="required">Tanggal Surat</label>
                <input id="tanggal_surat_panitia" type="text" placeholder="Contoh: 25 Oktober 2023" oninput="updatePreview()" required>
                <span class="error-message">Tanggal surat harus diisi.</span>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="nama_kegiatan" class="required">Nama Kegiatan</label>
            <input id="nama_kegiatan" type="text" placeholder="Contoh: Ujian Tengah Semester" oninput="updatePreview(); updateSusunanPanitiaPreview()" required>
            <span class="error-message">Nama kegiatan harus diisi.</span>
          </div>
          <div class="form-group">
            <label for="tahun_kegiatan" class="required">Tahun Kegiatan</label>
            <input id="tahun_kegiatan" type="text" placeholder="Contoh: 2023" oninput="updatePreview(); updateSusunanPanitiaPreview()" required>
            <span class="error-message">Tahun kegiatan harus diisi.</span>
          </div>
        </fieldset>
        
        <fieldset>
          <legend>Susunan Panitia</legend>
          <div class="form-group">
            <label for="ketua_panitia" class="required">Ketua Panitia</label>
            <input id="ketua_panitia" type="text" placeholder="Nama Ketua Panitia" oninput="updatePreview(); updateSusunanPanitiaPreview()" required>
            <span class="error-message">Ketua panitia harus diisi.</span>
          </div>
          <div class="form-group">
            <label for="wakil_ketua">Wakil Ketua</label>
            <input id="wakil_ketua" type="text" placeholder="Nama Wakil Ketua" oninput="updatePreview(); updateSusunanPanitiaPreview()">
          </div>
          <div class="form-group">
            <label for="sekretaris" class="required">Sekretaris</label>
            <input id="sekretaris" type="text" placeholder="Nama Sekretaris" oninput="updatePreview(); updateSusunanPanitiaPreview()" required>
            <span class="error-message">Sekretaris harus diisi.</span>
          </div>
          <div class="form-group">
            <label for="bendahara_panitia" class="required">Bendahara</label>
            <input id="bendahara_panitia" type="text" placeholder="Nama Bendahara" oninput="updatePreview(); updateSusunanPanitiaPreview()" required>
            <span class="error-message">Bendahara harus diisi.</span>
          </div>
          <div class="form-group">
            <label for="anggota_panitia">Anggota Panitia (pisahkan dengan koma)</label>
            <textarea id="anggota_panitia" rows="3" placeholder="Contoh: Budi Santoso, Siti Aminah, Ahmad Fauzi" oninput="updatePreview(); updateSusunanPanitiaPreview()"></textarea>
          </div>
        </fieldset>
      </form>
    </div>
    
    <div id="tabPanitia2" class="tab-content">
      <h4>Susunan Panitia (Lampiran 1)</h4>
      <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 15px;">Susunan panitia akan muncul di lampiran 1</p>
      
      <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
        <h5>Preview Susunan Panitia:</h5>
        <div id="susunanPanitiaPreview" style="margin-top: 10px;">
          <p><strong>Ketua:</strong> <span id="previewKetua">-</span></p>
          <p><strong>Wakil Ketua:</strong> <span id="previewWakil">-</span></p>
          <p><strong>Sekretaris:</strong> <span id="previewSekretaris">-</span></p>
          <p><strong>Bendahara:</strong> <span id="previewBendahara">-</span></p>
          <p><strong>Anggota:</strong> <span id="previewAnggota">-</span></p>
        </div>
      </div>
    </div>
    
    <div id="tabPanitia3" class="tab-content">
      <h4>Daftar Pengawas (Lampiran 2)</h4>
      <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 15px;">Isi data pengawas untuk lampiran 2</p>
      
      <div id="pengawasTableContainer">
        <!-- Dynamic rows will be added here -->
      </div>
      
      <button type="button" class="add-row-btn" onclick="addPengawasRow()">
        <i class="fas fa-plus"></i> Tambah Pengawas
      </button>
    </div>
  `,
  
  surat_edaran: `
    <form id="suratForm">
      <fieldset>
        <legend>Data Surat Edaran</legend>
        <div style="display: flex; gap: 16px; margin-bottom: 15px; flex-wrap: wrap;">
          <div style="flex: 1 1 200px;">
            <div class="form-group">
              <label for="nomor_edaran" class="required">Nomor Surat</label>
              <input id="nomor_edaran" type="text" placeholder="Contoh: 001/SE/IX/2023" oninput="updatePreview()" required>
              <span class="error-message">Nomor surat harus diisi.</span>
            </div>
          </div>
          <div style="flex: 1 1 200px;">
            <div class="form-group">
              <label for="tanggal_edaran" class="required">Tanggal Surat</label>
              <input id="tanggal_edaran" type="text" placeholder="Contoh: 25 Oktober 2023" oninput="updatePreview()" required>
              <span class="error-message">Tanggal surat harus diisi.</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="tahun_pelajaran_edaran" class="required">Tahun Pelajaran</label>
          <input id="tahun_pelajaran_edaran" type="text" placeholder="Contoh: 2023/2024" oninput="updatePreview()" required>
          <span class="error-message">Tahun pelajaran harus diisi.</span>
        </div>
        <div class="form-group">
          <label for="tanggal_mulai_pembayaran" class="required">Tanggal Mulai Pembayaran</label>
          <input id="tanggal_mulai_pembayaran" type="text" placeholder="Contoh: 1 November 2023" oninput="updatePreview()" required>
          <span class="error-message">Tanggal mulai pembayaran harus diisi.</span>
        </div>
        <div class="form-group">
          <label for="tanggal_akhir_pembayaran" class="required">Tanggal Akhir Pembayaran</label>
          <input id="tanggal_akhir_pembayaran" type="text" placeholder="Contoh: 15 November 2023" oninput="updatePreview()" required>
          <span class="error-message">Tanggal akhir pembayaran harus diisi.</span>
        </div>
        <div class="form-group">
          <label for="metode_pembayaran" class="required">Metode Pembayaran</label>
          <input id="metode_pembayaran" type="text" placeholder="Contoh: Bendahara Sekolah/Transfer Rekening" oninput="updatePreview()" required>
          <span class="error-message">Metode pembayaran harus diisi.</span>
        </div>
      </fieldset>
      
      <h4>Rincian Biaya Sekolah</h4>
      <p style="font-size: 12px; color: var(--text-muted); margin-bottom: 15px;">Isi data rincian biaya untuk surat edaran</p>
      
      <div id="biayaTableContainer">
        <!-- Dynamic rows will be added here -->
      </div>
      
      <button type="button" class="add-row-btn" onclick="addBiayaRow()">
        <i class="fas fa-plus"></i> Tambah Rincian Biaya
      </button>
    </form>
  `,
  
  surat_pemanggilan: `
    <form id="suratForm">
      <fieldset>
        <legend>Data Surat Pemanggilan</legend>
        <div style="display: flex; gap: 16px; margin-bottom: 15px; flex-wrap: wrap;">
          <div style="flex: 1 1 200px;">
            <div class="form-group">
              <label for="nomor_pemanggilan" class="required">Nomor Surat</label>
              <input id="nomor_pemanggilan" type="text" placeholder="Contoh: 001/SP/IX/2023" oninput="updatePreview()" required>
              <span class="error-message">Nomor surat harus diisi.</span>
            </div>
          </div>
          <div style="flex: 1 1 200px;">
            <div class="form-group">
              <label for="tanggal_pemanggilan" class="required">Tanggal Surat</label>
              <input id="tanggal_pemanggilan" type="text" placeholder="Contoh: 25 Oktober 2023" oninput="updatePreview()" required>
              <span class="error-message">Tanggal surat harus diisi.</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="nama_siswa" class="required">Nama Siswa</label>
          <input id="nama_siswa" type="text" placeholder="Nama lengkap siswa" oninput="updatePreview()" required>
          <span class="error-message">Nama siswa harus diisi.</span>
        </div>
        <div class="form-group">
          <label for="kelas_siswa" class="required">Kelas Siswa</label>
          <input id="kelas_siswa" type="text" placeholder="Contoh: X IPA 1" oninput="updatePreview()" required>
          <span class="error-message">Kelas siswa harus diisi.</span>
        </div>
        <div class="form-group">
          <label for="hari_tanggal" class="required">Hari/Tanggal Pertemuan</label>
          <input id="hari_tanggal" type="text" placeholder="Contoh: Senin, 30 Oktober 2023" oninput="updatePreview()" required>
          <span class="error-message">Hari/tanggal harus diisi.</span>
        </div>
        <div class="form-group">
          <label for="waktu_pertemuan" class="required">Waktu Pertemuan</label>
          <input id="waktu_pertemuan" type="text" placeholder="Contoh: 08.00 - 10.00 WIB" oninput="updatePreview()" required>
          <span class="error-message">Waktu pertemuan harus diisi.</span>
        </div>
        <div class="form-group">
          <label for="tempat_pertemuan" class="required">Tempat Pertemuan</label>
          <input id="tempat_pertemuan" type="text" placeholder="Contoh: Ruang Kepala Sekolah" oninput="updatePreview()" required>
          <span class="error-message">Tempat pertemuan harus diisi.</span>
        </div>
        <div class="form-group">
          <label for="agenda" class="required">Agenda Pertemuan</label>
          <textarea id="agenda" rows="3" placeholder="Deskripsi agenda pertemuan" oninput="updatePreview()" required></textarea>
          <span class="error-message">Agenda harus diisi.</span>
        </div>
      </fieldset>
    </form>
  `
};

// --- LETTER TEMPLATES dengan Kop Surat Baru dan Tanda Tangan di KANAN BAWAH ---
const templates = {
  sk_keputusan: data => {
    const guruData = data.guruData || [];
    
    return {
      lembar1: `
        <div class="letterhead">
          <div class="logo-placeholder">
            ${logoDataUrl ? `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi">` : '<i class="fas fa-school"></i>'}
          </div>
          <div class="letterhead-text">
            <p class="yayasan">${data.yayasan ? data.yayasan.toUpperCase() : 'YAYASAN ASH SHIDIQI MATARAM BARU'}</p>
            <p class="sekolah"><strong>${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</strong></p>
            <p class="alamat">
              Alamat : ${data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199'}
            </p>
          </div>
        </div>
        
        <div class="center" style="margin-bottom: 20px;">
          <h3 class="u">SURAT KEPUTUSAN</h3>
          <h3 class="u">KEPALA ${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</h3>
          <p style="font-size: 12pt; text-align: center; margin-top: 0; line-height: 1.5;">NOMOR : ${data.nomor_surat || '……………………………'}</p>
        </div>
        
        <div class="center" style="margin-bottom: 30px;">
          <h3 class="u">TENTANG :</h3>
          <p style="font-size: 12pt; text-align: center; margin-top: 0; line-height: 1.5;">
            PEMBAGIAN TUGAS GURU / STAF / KARYAWAN<br>
            DALAM KEGIATAN PROSES BELAJAR MENGAJAR ATAU BIMBINGAN<br>
            Tahun Pelajaran ${data.tahun_pelajaran || '20…./20….'}
          </p>
        </div>
        
        <table class="tiga-kolom">
          <tr>
            <td>Menimbang</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Bahwa dalam rangka memperlancar pelaksanaan proses belajar mengajar di ${data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU'} perlu menetapkan Pembagian Tugas Guru.</td>
          </tr>
          <tr>
            <td>Mengingat</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">
              <div style="margin-left: 0;">
                <div>1. Undang-Undang Nomor 20 Tahun 2003, tentang Sistem Pendidikan Nasional</div>
                <div>2. Keputusan Menteri Pendidikan Nasional Republik Indonesia Nomor : 118/U/2002, tentang Penyesuaian Garis-Garis Besar Program Pengajaran dan Penilaian pada Sistem Semester.</div>
                <div>3. Kurikulum tahun 2006 dan Kurikulum KTSP</div>
                <div>4. PMA Nomor 00012 tentang kurikulum 2013</div>
                <div>5. Pedoman Penghitungan Beban Kerja Guru Departemen Pendidikan Nasional</div>
              </div>
            </td>
          </tr>
        </table>
        
        <div class="center" style="margin: 20px 0;">
          <h3 class="u">MEMUTUSKAN</h3>
        </div>
        
        <table class="tiga-kolom">
          <tr>
            <td>Menetapkan</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Pembagian Tugas Guru Dalam Proses Belajar Mengajar</td>
          </tr>
          <tr>
            <td>Pertama</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Pembagian tugas guru dalam kegiatan belajar mengajar pada tahun pembelajaran seperti tersebut lampiran I Keputusan ini.</td>
          </tr>
          <tr>
            <td>Kedua</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Memutuskan guru untuk melaksanakan tugas tambahan dan tugas bimbingan seperti tersebut pada lampiran Ke-II Keputusan ini.</td>
          </tr>
          <tr>
            <td>Ketiga</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Masing-masing Guru melaporkan pelaksanaan tugasnya secara tertulis dan berkala kepada Kepala Sekolah.</td>
          </tr>
          <tr>
            <td>Keempat</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Segala biaya yang timbul akibat pelaksanaan keputusan ini dibebankan pada anggaran yang sesuai.</td>
          </tr>
          <tr>
            <td>Kelima</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Apabila terdapat kekeliruan dalam keputusan ini, akan dibetulkan sebagaimana mestinya.</td>
          </tr>
          <tr>
            <td>Keenam</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Keputusan ini berlaku sejak tanggal ditetapkan dengan catatan apabila terdapat kekeliruan dalam keputusan ini akan dibetulkan sebagaimana mestinya.</td>
          </tr>
        </table>
        
        <!-- TANDA TANGAN DI KANAN BAWAH - SURAT RESMI -->
        <div class="signature-right-container">
          <div class="tempat-tanggal-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: left;">
              <p>Ditetapkan di : ${data.tempat_ttd || 'Rajabasa Baru'}</p>
              <p>Pada tanggal  : ${data.tanggal_surat || '……………………………'}</p>
            </div>
          </div>
          
          <div class="penandatanganan-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: center;">
              <p class="jabatan">Kepala ${data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU'}</p>
              <br style="line-height: 0.5;">
              <p class="nama"><strong><u>${data.nama_kepala_sekolah || '……………………………'}</u></strong></p>
              <p class="nip">${data.nip_kepala_sekolah || 'NIP. .................................'}</p>
            </div>
          </div>
        </div>
      `,
      
      lembar2: `
        <div class="letterhead">
          <div class="logo-placeholder">
            ${logoDataUrl ? `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi">` : '<i class="fas fa-school"></i>'}
          </div>
          <div class="letterhead-text">
            <p class="yayasan">${data.yayasan ? data.yayasan.toUpperCase() : 'YAYASAN ASH SHIDIQI MATARAM BARU'}</p>
            <p class="sekolah"><strong>${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</strong></p>
            <p class="alamat">
              Alamat : ${data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199'}
            </p>
          </div>
        </div>
        
        <div class="lampiran-header">
          <h3 class="u">LAMPIRAN I</h3>
          <p style="font-size: 12pt; margin-top: 5px;">Nomor: ${data.nomor_surat || '……………………………'}</p>
          <p style="font-size: 12pt; margin-top: 5px;">Tanggal: ${data.tanggal_surat || '……………………………'}</p>
        </div>
        
        <div class="center" style="margin-bottom: 20px;">
          <p class="u" style="font-size: 14pt; margin-top: 10px; line-height: 1.5;">PEMBAGIAN TUGAS GURU DAN TENAGA KEPENDIDIKAN</p>
          <p style="font-size: 12pt; margin-top: 5px; line-height: 1.5;">TAHUN PELAJARAN ${data.tahun_pelajaran || '20…./20….'}</p>
        </div>
        
        <table class="dengan-garis">
          <thead>
            <tr>
              <th>No</th>
              <th>Nama Guru</th>
              <th>Mata Pelajaran</th>
              <th>Kelas</th>
              <th>JTM</th>
            </tr>
          </thead>
          <tbody>
            ${guruData.length > 0 ? 
              guruData.map((guru, index) => `
                <tr>
                  <td>${index + 1}</td>
                  <td>${guru.nama || '........................'}</td>
                  <td>${guru.mapel || '........................'}</td>
                  <td>${guru.kelas || '.........'}</td>
                  <td>${guru.jtm || '....'}</td>
                </tr>
              `).join('') : 
              `<tr><td colspan="5" style="text-align: center;">Belum ada data guru</td></tr>`
            }
          </tbody>
        </table>
        
        <!-- TANDA TANGAN DI KANAN BAWAH - SURAT RESMI -->
        <div class="signature-right-container">
          <div class="tempat-tanggal-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: left;">
              <p>Ditetapkan di : ${data.tempat_ttd || 'Rajabasa Baru'}</p>
              <p>Pada tanggal  : ${data.tanggal_surat || '……………………………'}</p>
            </div>
          </div>
          
          <div class="penandatanganan-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: center;">
              <p class="jabatan">Kepala ${data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU'}</p>
              <br style="line-height: 0.5;">
              <p class="nama"><strong><u>${data.nama_kepala_sekolah || '……………………………'}</u></strong></p>
              <p class="nip">${data.nip_kepala_sekolah || 'NIP. .................................'}</p>
            </div>
          </div>
        </div>
      `,
      
      lembar3: `
        <div class="letterhead">
          <div class="logo-placeholder">
            ${logoDataUrl ? `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi">` : '<i class="fas fa-school"></i>'}
          </div>
          <div class="letterhead-text">
            <p class="yayasan">${data.yayasan ? data.yayasan.toUpperCase() : 'YAYASAN ASH SHIDIQI MATARAM BARU'}</p>
            <p class="sekolah"><strong>${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</strong></p>
            <p class="alamat">
              Alamat : ${data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199'}
            </p>
          </div>
        </div>
        
        <div class="lampiran-header">
          <h3 class="u">LAMPIRAN II</h3>
          <p style="font-size: 12pt; margin-top: 5px;">Nomor: ${data.nomor_surat || '……………………………'}</p>
          <p style="font-size: 12pt; margin-top: 5px;">Tanggal: ${data.tanggal_surat || '……………………………'}</p>
        </div>
        
        <div class="center" style="margin-bottom: 20px;">
          <p class="u" style="font-size: 14pt; margin-top: 10px; line-height: 1.5;">PEMBAGIAN TUGAS TAMBAHAN GURU</p>
          <p style="font-size: 12pt; margin-top: 5px; line-height: 1.5;">TAHUN PELAJARAN ${data.tahun_pelajaran || '20…./20….'}</p>
        </div>
        
        <div style="margin: 30px 0;">
          <table class="tanpa-garis">
            <tr>
              <td style="width: 40%; font-weight: bold;">KEPALA MADRASAH</td>
              <td style="width: 5%;">:</td>
              <td>${data.kepala_madrasah || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">WAKA. KURIKULUM</td>
              <td>:</td>
              <td>${data.waka_kurikulum || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">WAKA. KESISWAAN</td>
              <td>:</td>
              <td>${data.waka_kesiswaan || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">BENDAHARA</td>
              <td>:</td>
              <td>${data.bendahara || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">HUMAS</td>
              <td>:</td>
              <td>${data.humas || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">SARPRAS</td>
              <td>:</td>
              <td>${data.sarpras || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">WALI KELAS X</td>
              <td>:</td>
              <td>${data.wali_kelas_x || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">WALI KELAS XI</td>
              <td>:</td>
              <td>${data.wali_kelas_xi || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">WALI KELAS XII</td>
              <td>:</td>
              <td>${data.wali_kelas_xii || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">OPERATOR</td>
              <td>:</td>
              <td>${data.operator || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">TATA USAHA</td>
              <td>:</td>
              <td>${data.tata_usaha || '.................................'}</td>
            </tr>
          </table>
        </div>
        
        <!-- TANDA TANGAN DI KANAN BAWAH - SURAT RESMI -->
        <div class="signature-right-container">
          <div class="tempat-tanggal-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: left;">
              <p>Ditetapkan di : ${data.tempat_ttd || 'Rajabasa Baru'}</p>
              <p>Pada tanggal  : ${data.tanggal_surat || '……………………………'}</p>
            </div>
          </div>
          
          <div class="penandatanganan-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: center;">
              <p class="jabatan">Kepala ${data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU'}</p>
              <br style="line-height: 0.5;">
              <p class="nama"><strong><u>${data.nama_kepala_sekolah || '……………………………'}</u></strong></p>
              <p class="nip">${data.nip_kepala_sekolah || 'NIP. .................................'}</p>
            </div>
          </div>
        </div>
      `
    };
  },
  
  sk_panitia: data => {
    const pengawasData = data.pengawasData || [];
    const anggotaArray = data.anggota_panitia ? data.anggota_panitia.split(',').map(a => a.trim()).filter(a => a) : [];
    
    return {
      lembar1: `
        <div class="letterhead">
          <div class="logo-placeholder">
            ${logoDataUrl ? `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi">` : '<i class="fas fa-school"></i>'}
          </div>
          <div class="letterhead-text">
            <p class="yayasan">${data.yayasan ? data.yayasan.toUpperCase() : 'YAYASAN ASH SHIDIQI MATARAM BARU'}</p>
            <p class="sekolah"><strong>${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</strong></p>
            <p class="alamat">
              Alamat : ${data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199'}
            </p>
          </div>
        </div>
        
        <div class="center" style="margin-bottom: 20px;">
          <h3 class="u">SURAT KEPUTUSAN</h3>
          <h3 class="u">KEPALA ${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</h3>
          <p style="font-size: 12pt; text-align: center; margin-top: 0; line-height: 1.5;">NOMOR : ${data.nomor_surat_panitia || '……………………………'}</p>
        </div>
        
        <div class="center" style="margin-bottom: 30px;">
          <h3 class="u">TENTANG :</h3>
          <p style="font-size: 12pt; text-align: center; margin-top: 0; line-height: 1.5;">
            PEMBENTUKAN PANITIA PELAKSANA<br>
            ${data.nama_kegiatan ? data.nama_kegiatan.toUpperCase() : 'KEGIATAN SEKOLAH'}<br>
            TAHUN ${data.tahun_kegiatan || '20..'}
          </p>
        </div>
        
        <table class="tiga-kolom">
          <tr>
            <td>Menimbang</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Bahwa dalam rangka pelaksanaan ${data.nama_kegiatan || 'kegiatan sekolah'} di ${data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU'} perlu dibentuk Panitia Pelaksana.</td>
          </tr>
          <tr>
            <td>Mengingat</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">
              <div style="margin-left: 0;">
                <div>1. Undang-Undang Nomor 20 Tahun 2003 tentang Sistem Pendidikan Nasional</div>
                <div>2. Peraturan Pemerintah tentang Pengelolaan dan Penyelenggaraan Pendidikan</div>
                <div>3. Peraturan Menteri Pendidikan dan Kebudayaan terkait</div>
                <div>4. Rapat Persiapan tanggal ${data.tanggal_surat_panitia || '...................'}</div>
              </div>
            </td>
          </tr>
        </table>
        
        <div class="center" style="margin: 20px 0;">
          <h3 class="u">MEMUTUSKAN</h3>
        </div>
        
        <table class="tiga-kolom">
          <tr>
            <td>Menetapkan</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Pembentukan Panitia Pelaksana ${data.nama_kegiatan || 'Kegiatan Sekolah'}</td>
          </tr>
          <tr>
            <td>Kesatu</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Membentuk Panitia Pelaksana ${data.nama_kegiatan || 'Kegiatan Sekolah'} dengan susunan sebagai berikut:</td>
          </tr>
        </table>
        
        <table class="tiga-kolom">
          <tr>
            <td>Kedua</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Panitia sebagaimana dimaksud dalam diktum Kesatu mempunyai tugas menyusun program kerja, melaksanakan kegiatan, dan membuat laporan pertanggungjawaban.</td>
          </tr>
          <tr>
            <td>Ketiga</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Segala biaya yang timbul akibat pelaksanaan keputusan ini dibebankan pada anggaran yang sesuai.</td>
          </tr>
          <tr>
            <td>Keempat</td>
            <td>:</td>
            <td style="text-align: justify; line-height: 1.5;">Keputusan ini berlaku sejak tanggal ditetapkan.</td>
          </tr>
        </table>
        
        <!-- TANDA TANGAN DI KANAN BAWAH - SURAT RESMI -->
        <div class="signature-right-container">
          <div class="tempat-tanggal-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: left;">
              <p>Ditetapkan di : ${data.tempat_ttd || 'Rajabasa Baru'}</p>
              <p>Pada tanggal  : ${data.tanggal_surat_panitia || '……………………………'}</p>
            </div>
          </div>
          
          <div class="penandatanganan-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: center;">
              <p class="jabatan">Kepala ${data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU'}</p>
              <br style="line-height: 0.5;">
              <p class="nama"><strong><u>${data.nama_kepala_sekolah || '……………………………'}</u></strong></p>
              <p class="nip">${data.nip_kepala_sekolah || 'NIP. .................................'}</p>
            </div>
          </div>
        </div>
      `,
      
      lembar2: `
        <div class="letterhead">
          <div class="logo-placeholder">
            ${logoDataUrl ? `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi">` : '<i class="fas fa-school"></i>'}
          </div>
          <div class="letterhead-text">
            <p class="yayasan">${data.yayasan ? data.yayasan.toUpperCase() : 'YAYASAN ASH SHIDIQI MATARAM BARU'}</p>
            <p class="sekolah"><strong>${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</strong></p>
            <p class="alamat">
              Alamat : ${data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199'}
            </p>
          </div>
        </div>
        
        <div class="lampiran-header">
          <h3 class="u">LAMPIRAN I</h3>
          <p style="font-size: 12pt; margin-top: 5px;">Nomor: ${data.nomor_surat_panitia || '……………………………'}</p>
          <p style="font-size: 12pt; margin-top: 5px;">Tanggal: ${data.tanggal_surat_panitia || '……………………………'}</p>
        </div>
        
        <div class="center" style="margin-bottom: 20px;">
          <p class="u" style="font-size: 14pt; margin-top: 10px; line-height: 1.5;">SUSUNAN PANITIA PELAKSANA</p>
          <p style="font-size: 12pt; margin-top: 5px; line-height: 1.5;">${data.nama_kegiatan ? data.nama_kegiatan.toUpperCase() : 'KEGIATAN SEKOLAH'} TAHUN ${data.tahun_kegiatan || '20..'}</p>
        </div>
        
        <div style="margin: 30px 0;">
          <table class="tanpa-garis">
            <tr>
              <td style="width: 30%; font-weight: bold;">KETUA</td>
              <td style="width: 5%;">:</td>
              <td>${data.ketua_panitia || '.................................'}</td>
            </tr>
            ${data.wakil_ketua ? `
            <tr>
              <td style="font-weight: bold;">WAKIL KETUA</td>
              <td>:</td>
              <td>${data.wakil_ketua}</td>
            </tr>
            ` : ''}
            <tr>
              <td style="font-weight: bold;">SEKRETARIS</td>
              <td>:</td>
              <td>${data.sekretaris || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold;">BENDAHARA</td>
              <td>:</td>
              <td>${data.bendahara_panitia || '.................................'}</td>
            </tr>
            <tr>
              <td style="font-weight: bold; vertical-align: top;">ANGGOTA</td>
              <td style="vertical-align: top;">:</td>
              <td>
                ${anggotaArray.length > 0 ? 
                  anggotaArray.map((anggota, index) => `
                    <div>${index + 1}. ${anggota}</div>
                  `).join('') : 
                  '<div>-</div>'
                }
              </td>
            </tr>
          </table>
        </div>
        
        <!-- TANDA TANGAN DI KANAN BAWAH - SURAT RESMI -->
        <div class="signature-right-container">
          <div class="tempat-tanggal-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: left;">
              <p>Ditetapkan di : ${data.tempat_ttd || 'Rajabasa Baru'}</p>
              <p>Pada tanggal  : ${data.tanggal_surat_panitia || '……………………………'}</p>
            </div>
          </div>
          
          <div class="penandatanganan-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: center;">
              <p class="jabatan">Kepala ${data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU'}</p>
              <br style="line-height: 0.5;">
              <p class="nama"><strong><u>${data.nama_kepala_sekolah || '……………………………'}</u></strong></p>
              <p class="nip">${data.nip_kepala_sekolah || 'NIP. .................................'}</p>
            </div>
          </div>
        </div>
      `,
      
      lembar3: `
        <div class="letterhead">
          <div class="logo-placeholder">
            ${logoDataUrl ? `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi">` : '<i class="fas fa-school"></i>'}
          </div>
          <div class="letterhead-text">
            <p class="yayasan">${data.yayasan ? data.yayasan.toUpperCase() : 'YAYASAN ASH SHIDIQI MATARAM BARU'}</p>
            <p class="sekolah"><strong>${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</strong></p>
            <p class="alamat">
              Alamat : ${data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199'}
            </p>
          </div>
        </div>
        
        <div class="lampiran-header">
          <h3 class="u">LAMPIRAN II</h3>
          <p style="font-size: 12pt; margin-top: 5px;">Nomor: ${data.nomor_surat_panitia || '……………………………'}</p>
          <p style="font-size: 12pt; margin-top: 5px;">Tanggal: ${data.tanggal_surat_panitia || '……………………………'}</p>
        </div>
        
        <div class="center" style="margin-bottom: 20px;">
          <p class="u" style="font-size: 14pt; margin-top: 10px; line-height: 1.5;">DAFTAR PENGAWAS</p>
          <p style="font-size: 12pt; margin-top: 5px; line-height: 1.5;">${data.nama_kegiatan ? data.nama_kegiatan.toUpperCase() : 'KEGIATAN SEKOLAH'} TAHUN ${data.tahun_kegiatan || '20..'}</p>
        </div>
        
        <table class="dengan-garis">
          <thead>
            <tr>
              <th>No</th>
              <th>Nama Guru</th>
              <th>Jabatan</th>
            </tr>
          </thead>
          <tbody>
            ${pengawasData.length > 0 ? 
              pengawasData.map((pengawas, index) => `
                <tr>
                  <td>${index + 1}</td>
                  <td>${pengawas.nama || '........................'}</td>
                  <td>${pengawas.jabatan || '........................'}</td>
                </tr>
              `).join('') : 
              `<tr><td colspan="3" style="text-align: center;">Belum ada data pengawas</td></tr>`
            }
          </tbody>
        </table>
        
        <!-- TANDA TANGAN DI KANAN BAWAH - SURAT RESMI -->
        <div class="signature-right-container">
          <div class="tempat-tanggal-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: left;">
              <p>Ditetapkan di : ${data.tempat_ttd || 'Rajabasa Baru'}</p>
              <p>Pada tanggal  : ${data.tanggal_surat_panitia || '……………………………'}</p>
            </div>
          </div>
          
          <div class="penandatanganan-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: center;">
              <p class="jabatan">Kepala ${data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU'}</p>
              <br style="line-height: 0.5;">
              <p class="nama"><strong><u>${data.nama_kepala_sekolah || '……………………………'}</u></strong></p>
              <p class="nip">${data.nip_kepala_sekolah || 'NIP. .................................'}</p>
            </div>
          </div>
        </div>
      `
    };
  },
  
  surat_edaran: data => {
    const biayaData = data.biayaData || [];
    
    return {
      lembar1: `
        <div class="letterhead">
          <div class="logo-placeholder">
            ${logoDataUrl ? `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi">` : '<i class="fas fa-school"></i>'}
          </div>
          <div class="letterhead-text">
            <p class="yayasan">${data.yayasan ? data.yayasan.toUpperCase() : 'YAYASAN ASH SHIDIQI MATARAM BARU'}</p>
            <p class="sekolah"><strong>${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</strong></p>
            <p class="alamat">
              Alamat : ${data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199'}
            </p>
          </div>
        </div>
        
        <div class="center" style="margin-bottom: 20px;">
          <h3 class="u">SURAT EDARAN</h3>
          <p style="font-size: 12pt; text-align: center; margin-top: 0; line-height: 1.5;">NOMOR : ${data.nomor_edaran || '……………………………'}</p>
        </div>
        
        <div class="center" style="margin-bottom: 30px;">
          <h3 class="u">TENTANG</h3>
          <p class="u" style="font-size: 14pt; margin-top: 10px; line-height: 1.5;">Pemberitahuan Biaya Sekolah</p>
          <p style="font-size: 12pt; margin-top: 5px; line-height: 1.5;">TAHUN PELAJARAN ${data.tahun_pelajaran_edaran || '20…./20….'}</p>
        </div>
        
        <div class="justify" style="margin: 20px 0;">
          <p style="line-height: 1.5;">Yth.</p>
          <p style="line-height: 1.5;">Bapak/Ibu Orang Tua/Wali Peserta Didik</p>
          <p style="line-height: 1.5;">di</p>
          <p style="line-height: 1.5;">Tempat</p>
        </div>
        
        <div class="justify" style="margin: 20px 0;">
          <p style="line-height: 1.5;">Assalamu'alaikum Wr. Wb</p>
          <p style="line-height: 1.5;">Dengan hormat,</p>
          <p style="line-height: 1.5;">Dalam rangka menunjang kelancaran proses pembelajaran dan operasional sekolah pada Tahun Pelajaran ${data.tahun_pelajaran_edaran || '20…./20….'}, bersama ini kami sampaikan pemberitahuan mengenai biaya sekolah yang perlu dipenuhi oleh orang tua/wali peserta didik.</p>
        </div>
        
        <div class="justify" style="margin: 20px 0;">
          <p style="line-height: 1.5;">Adapun rincian biaya sekolah dimaksud meliputi:</p>
          <table class="dengan-garis">
            <thead>
              <tr>
                <th>No</th>
                <th>Rincian</th>
                <th>Kelas X</th>
                <th>Kelas XI</th>
                <th>Kelas XII</th>
              </tr>
            </thead>
            <tbody>
              ${biayaData.length > 0 ? 
                biayaData.map((biaya, index) => `
                  <tr>
                    <td>${index + 1}</td>
                    <td>${biaya.rincian || '................'}</td>
                    <td>${biaya.kelas_x || '........'}</td>
                    <td>${biaya.kelas_xi || '........'}</td>
                    <td>${biaya.kelas_xii || '........'}</td>
                  </tr>
                `).join('') : 
                `<tr><td colspan="5" style="text-align: center;">Belum ada data biaya</td></tr>`
            }
            </tbody>
          </table>
        </div>
        
        <div class="justify" style="margin: 20px 0;">
          <p style="line-height: 1.5;">Pembayaran biaya sekolah tersebut dapat dilakukan mulai tanggal ${data.tanggal_mulai_pembayaran || '…………………'} sampai dengan ${data.tanggal_akhir_pembayaran || '…………………'} melalui ${data.metode_pembayaran || '…………………'} (bendahara sekolah/transfer rekening sekolah). Langsung ke bendahara Sekolah</p>
        </div>
        
        <div class="justify" style="margin: 20px 0;">
          <p style="line-height: 1.5;">Kami berharap Bapak/Ibu dapat bekerja sama untuk memenuhi kewajiban ini tepat waktu demi kelancaran kegiatan belajar mengajar dan peningkatan mutu layanan pendidikan di sekolah kami.</p>
        </div>
        
        <div class="justify" style="margin: 20px 0;">
          <p style="line-height: 1.5;">Demikian surat edaran ini kami sampaikan. Atas perhatian dan kerja sama Bapak/Ibu, kami ucapkan terima kasih.</p>
          <p style="line-height: 1.5;">Wasalamu'alaikum wr.wb</p>
        </div>
        
        <!-- TANDA TANGAN DI KANAN BAWAH - SURAT RESMI -->
        <div class="signature-right-container">
          <div class="tempat-tanggal-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: left;">
              <p>Ditetapkan di : ${data.tempat_ttd || 'Rajabasa Baru'}</p>
              <p>Pada tanggal  : ${data.tanggal_edaran || '……………………………'}</p>
            </div>
          </div>
          
          <div class="penandatanganan-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="width: 50%; text-align: center;">
              <p class="jabatan">Kepala Sekolah</p>
              <br style="line-height: 0.5;">
              <p class="nama"><strong><u>${data.nama_kepala_sekolah || '……………………………'}</u></strong></p>
              <p class="nip">${data.nip_kepala_sekolah || 'NIP. .................................'}</p>
            </div>
          </div>
        </div>
      `
    };
  },
  
  surat_pemanggilan: data => {
    return {
      lembar1: `
        <div class="letterhead">
          <div class="logo-placeholder">
            ${logoDataUrl ? `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi">` : '<i class="fas fa-school"></i>'}
          </div>
          <div class="letterhead-text">
            <p class="yayasan">${data.yayasan ? data.yayasan.toUpperCase() : 'YAYASAN ASH SHIDIQI MATARAM BARU'}</p>
            <p class="sekolah"><strong>${data.nama_sekolah ? data.nama_sekolah.toUpperCase() : 'MA. ASH-SHIDIQI RAJABASA BARU'}</strong></p>
            <p class="alamat">
              Alamat : ${data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199'}
            </p>
          </div>
        </div>
        
        <div class="center" style="margin-bottom: 20px;">
          <h3 class="u">SURAT PEMANGGILAN</h3>
          <p style="font-size: 12pt; text-align: center; margin-top: 0; line-height: 1.5;">NOMOR : ${data.nomor_pemanggilan || '……………………………'}</p>
          <p style="font-size: 12pt; text-align: center; margin-top: 5px; line-height: 1.5;">LAMPIRAN : -</p>
          <p style="font-size: 12pt; text-align: center; margin-top: 5px; line-height: 1.5;">PERIHAL : Pemanggilan Orang Tua/Wali Siswa</p>
        </div>
        
        <div class="justify" style="margin: 20px 0;">
          <p style="line-height: 1.5;">Kepada Yth.</p>
          <p style="line-height: 1.5;">Bapak/Ibu Orang Tua/Wali</p>
          <p style="line-height: 1.5;">dari Ananda <strong>${data.nama_siswa || '……………………………'}</strong></p>
          <p style="line-height: 1.5;">Kelas <strong>${data.kelas_siswa || '……………………………'}</strong></p>
          <p style="line-height: 1.5;">di</p>
          <p style="line-height: 1.5;">&nbsp;&nbsp;&nbsp;&nbsp;Tempat</p>
        </div>
        
        <div class="justify" style="margin: 20px 0;">
          <p style="line-height: 1.5;">Assalamu'alaikum Wr. Wb</p>
          <p style="line-height: 1.5;">Dengan hormat,</p>
          <p style="line-height: 1.5;">Puji syukur ke hadirat Allah SWT atas limpahan rahmat dan karunia-Nya. Semoga Bapak/Ibu senantiasa berada dalam keadaan sehat wal afiat.</p>
          <p style="line-height: 1.5;">Sehubungan dengan hasil pengamatan pihak sekolah terhadap perkembangan akademik, kehadiran, serta sikap dan perilaku Ananda <strong>${data.nama_siswa || '……………………………'}</strong> selama mengikuti kegiatan pembelajaran di sekolah, maka kami memandang perlu adanya komunikasi dan kerja sama yang lebih intensif antara pihak sekolah dengan orang tua/wali siswa.</p>
          <p style="line-height: 1.5;">Oleh karena itu, kami mengundang Bapak/Ibu Orang Tua/Wali untuk dapat hadir ke sekolah guna membahas beberapa hal yang berkaitan dengan perkembangan Ananda, serta untuk mencari solusi terbaik demi kemajuan dan kebaikan Ananda di masa yang akan datang.</p>
          <p style="line-height: 1.5;">Adapun pelaksanaan pertemuan tersebut akan dilaksanakan pada:</p>
          <p style="line-height: 1.5;">Hari/Tanggal &nbsp;&nbsp;&nbsp;&nbsp;: <strong>${data.hari_tanggal || '……………………………'}</strong></p>
          <p style="line-height: 1.5;">Waktu &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <strong>${data.waktu_pertemuan || '……………………………'}</strong></p>
          <p style="line-height: 1.5;">Tempat &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <strong>${data.tempat_pertemuan || '……………………………'}</strong></p>
          <p style="line-height: 1.5;">Agenda &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <strong>${data.agenda || '……………………………'}</strong></p>
          <p style="line-height: 1.5;">Kami sangat mengharapkan kehadiran Bapak/Ibu tepat pada waktu yang telah ditentukan. Apabila berhalangan hadir, mohon kiranya dapat mengonfirmasi kepada pihak sekolah terlebih dahulu.</p>
          <p style="line-height: 1.5;">Demikian surat pemanggilan ini kami sampaikan. Atas perhatian, dukungan, dan kerja sama Bapak/Ibu Orang Tua/Wali, kami ucapkan terima kasih.</p>
          <p style="line-height: 1.5;">Hormat kami,</p>
          
          <!-- TANDA TANGAN DI KANAN BAWAH - SURAT RESMI -->
          <div class="signature-right-container">
            <div class="tempat-tanggal-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
              <div style="width: 50%; text-align: left;">
                <p>Ditetapkan di : ${data.tempat_ttd || 'Rajabasa Baru'}</p>
                <p>Pada tanggal  : ${data.tanggal_pemanggilan || '……………………………'}</p>
              </div>
            </div>
            
            <div class="penandatanganan-kanan" style="width: 100%; display: flex; justify-content: flex-end;">
              <div style="width: 50%; text-align: center;">
                <p class="jabatan">Kepala Sekolah</p>
                <br style="line-height: 0.5;">
                <p class="nama"><strong><u>${data.nama_kepala_sekolah || '……………………………'}</u></strong></p>
                <p class="nip">${data.nip_kepala_sekolah || 'NIP. .................................'}</p>
              </div>
            </div>
          </div>
        </div>
      `
    };
  }
};

// --- HELPER FUNCTIONS ---
function getAllData() {
  const data = {};
  
  // Data Identitas Sekolah
  data.nama_sekolah = document.getElementById('nama_sekolah').value;
  data.kecamatan = document.getElementById('kecamatan').value;
  data.kabupaten = document.getElementById('kabupaten').value;
  data.yayasan = document.getElementById('yayasan').value;
  data.alamat_lengkap = document.getElementById('alamat_lengkap')?.value || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199';
  data.nama_kepala_sekolah = document.getElementById('nama_kepala_sekolah').value;
  data.tempat_ttd = document.getElementById('tempat_ttd').value;
  data.nip_kepala_sekolah = document.getElementById('nip_kepala_sekolah')?.value || 'NIP. .................................';
  
  // Data berdasarkan jenis surat
  if (currentJenisSurat === 'sk_keputusan') {
    data.nomor_surat = document.getElementById('nomor_surat')?.value || '';
    data.tanggal_surat = document.getElementById('tanggal_surat')?.value || '';
    data.tahun_pelajaran = document.getElementById('tahun_pelajaran')?.value || '';
    
    // Data Lampiran 1 (Guru)
    data.guruData = guruData;
    
    // Data Lampiran 2 (Tugas Tambahan)
    data.kepala_madrasah = document.getElementById('kepala_madrasah')?.value || '';
    data.waka_kurikulum = document.getElementById('waka_kurikulum')?.value || '';
    data.waka_kesiswaan = document.getElementById('waka_kesiswaan')?.value || '';
    data.bendahara = document.getElementById('bendahara')?.value || '';
    data.humas = document.getElementById('humas')?.value || '';
    data.sarpras = document.getElementById('sarpras')?.value || '';
    data.wali_kelas_x = document.getElementById('wali_kelas_x')?.value || '';
    data.wali_kelas_xi = document.getElementById('wali_kelas_xi')?.value || '';
    data.wali_kelas_xii = document.getElementById('wali_kelas_xii')?.value || '';
    data.operator = document.getElementById('operator')?.value || '';
    data.tata_usaha = document.getElementById('tata_usaha')?.value || '';
  } else if (currentJenisSurat === 'sk_panitia') {
    data.nomor_surat_panitia = document.getElementById('nomor_surat_panitia')?.value || '';
    data.tanggal_surat_panitia = document.getElementById('tanggal_surat_panitia')?.value || '';
    data.nama_kegiatan = document.getElementById('nama_kegiatan')?.value || '';
    data.tahun_kegiatan = document.getElementById('tahun_kegiatan')?.value || '';
    data.ketua_panitia = document.getElementById('ketua_panitia')?.value || '';
    data.wakil_ketua = document.getElementById('wakil_ketua')?.value || '';
    data.sekretaris = document.getElementById('sekretaris')?.value || '';
    data.bendahara_panitia = document.getElementById('bendahara_panitia')?.value || '';
    data.anggota_panitia = document.getElementById('anggota_panitia')?.value || '';
    
    // Data Pengawas untuk Lampiran
    data.pengawasData = pengawasData;
  } else if (currentJenisSurat === 'surat_edaran') {
    data.nomor_edaran = document.getElementById('nomor_edaran')?.value || '';
    data.tanggal_edaran = document.getElementById('tanggal_edaran')?.value || '';
    data.tahun_pelajaran_edaran = document.getElementById('tahun_pelajaran_edaran')?.value || '';
    data.tanggal_mulai_pembayaran = document.getElementById('tanggal_mulai_pembayaran')?.value || '';
    data.tanggal_akhir_pembayaran = document.getElementById('tanggal_akhir_pembayaran')?.value || '';
    data.metode_pembayaran = document.getElementById('metode_pembayaran')?.value || '';
    
    // Data Biaya untuk surat edaran
    data.biayaData = biayaData;
  } else if (currentJenisSurat === 'surat_pemanggilan') {
    data.nomor_pemanggilan = document.getElementById('nomor_pemanggilan')?.value || '';
    data.tanggal_pemanggilan = document.getElementById('tanggal_pemanggilan')?.value || '';
    data.nama_siswa = document.getElementById('nama_siswa')?.value || '';
    data.kelas_siswa = document.getElementById('kelas_siswa')?.value || '';
    data.hari_tanggal = document.getElementById('hari_tanggal')?.value || '';
    data.waktu_pertemuan = document.getElementById('waktu_pertemuan')?.value || '';
    data.tempat_pertemuan = document.getElementById('tempat_pertemuan')?.value || '';
    data.agenda = document.getElementById('agenda')?.value || '';
  }
  
  data.logoDataUrl = logoDataUrl;
  
  return data;
}

// --- CORE LOGIC ---
function handleJenisSuratChange() {
  currentJenisSurat = document.getElementById('jenisSurat').value;
  renderForm();
  updatePreview();
}

function renderForm() {
  const formContent = document.getElementById('dynamicFormContent');
  const template = formTemplates[currentJenisSurat] || '';
  formContent.innerHTML = template;
  
  // Inisialisasi data khusus untuk setiap jenis surat
  if (currentJenisSurat === 'sk_keputusan') {
    if (guruData.length === 0) {
      addGuruRow();
    } else {
      guruData.forEach((guru, index) => {
        addGuruRow(index);
      });
    }
  } else if (currentJenisSurat === 'sk_panitia') {
    if (pengawasData.length === 0) {
      addPengawasRow();
    } else {
      pengawasData.forEach((pengawas, index) => {
        addPengawasRow(index);
      });
    }
    updateSusunanPanitiaPreview();
  } else if (currentJenisSurat === 'surat_edaran') {
    if (biayaData.length === 0) {
      addBiayaRow();
    } else {
      biayaData.forEach((biaya, index) => {
        addBiayaRow(index);
      });
    }
  }
  
  // Format tanggal setelah form dirender
  setTimeout(() => {
    formatDateInputs();
  }, 50);
}

function updatePreview() {
  const data = getAllData();
  const template = templates[currentJenisSurat];
  const previewContainer = document.getElementById('previewContainer');
  
  if (!template) return;
  
  try {
    const previews = template(data);
    
    if (currentJenisSurat === 'sk_keputusan') {
      previewContainer.innerHTML = `
        <div id="preview1" class="preview">
          <div class="paper" id="paperContent1">
            ${previews.lembar1}
          </div>
        </div>
        <div id="preview2" class="preview">
          <div class="paper" id="paperContent2">
            ${previews.lembar2}
          </div>
        </div>
        <div id="preview3" class="preview">
          <div class="paper" id="paperContent3">
            ${previews.lembar3}
          </div>
        </div>
      `;
    } else if (currentJenisSurat === 'sk_panitia') {
      previewContainer.innerHTML = `
        <div id="preview1" class="preview">
          <div class="paper" id="paperContent1">
            ${previews.lembar1}
          </div>
        </div>
        <div id="preview2" class="preview">
          <div class="paper" id="paperContent2">
            ${previews.lembar2}
          </div>
        </div>
        <div id="preview3" class="preview">
          <div class="paper" id="paperContent3">
            ${previews.lembar3}
          </div>
        </div>
      `;
    } else if (currentJenisSurat === 'surat_edaran' || currentJenisSurat === 'surat_pemanggilan') {
      previewContainer.innerHTML = `
        <div id="preview1" class="preview">
          <div class="paper" id="paperContent1">
            ${previews.lembar1}
          </div>
        </div>
      `;
    }
  } catch (error) {
    console.error('Error updating preview:', error);
    previewContainer.innerHTML = '<div style="color: red; padding: 20px;">Terjadi kesalahan saat memperbarui preview.</div>';
  }
}

function toggleForm() {
  const formContainer = document.getElementById('formContainer');
  const toggleText = document.getElementById('toggleFormText');
  formContainer.classList.toggle('hidden');
  if (formContainer.classList.contains('hidden')) {
    toggleText.textContent = 'Buat Surat';
  } else {
    toggleText.textContent = 'Tutup Form';
  }
}

// Fungsi-fungsi untuk SK Keputusan
function addGuruRow(index = null) {
  if (currentJenisSurat !== 'sk_keputusan') return;
  
  const container = document.getElementById('guruTableContainer');
  if (!container) return;
  
  const rowId = index !== null ? index : guruData.length;
  
  const rowHtml = `
    <div class="dynamic-row" id="guruRow${rowId}">
      <input type="text" placeholder="Nama Guru" id="guruNama${rowId}" value="${guruData[rowId]?.nama || ''}" oninput="updateGuruData(${rowId})">
      <input type="text" placeholder="Mata Pelajaran" id="guruMapel${rowId}" value="${guruData[rowId]?.mapel || ''}" oninput="updateGuruData(${rowId})">
      <input type="text" placeholder="Kelas" id="guruKelas${rowId}" value="${guruData[rowId]?.kelas || ''}" oninput="updateGuruData(${rowId})">
      <input type="text" placeholder="JTM" id="guruJtm${rowId}" value="${guruData[rowId]?.jtm || ''}" oninput="updateGuruData(${rowId})">
      <button type="button" class="remove-row-btn" onclick="removeGuruRow(${rowId})">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `;
  
  if (index !== null) {
    const existingRow = document.getElementById(`guruRow${index}`);
    if (existingRow) {
      existingRow.outerHTML = rowHtml;
    }
  } else {
    container.insertAdjacentHTML('beforeend', rowHtml);
    guruData.push({ nama: '', mapel: '', kelas: '', jtm: '' });
  }
  
  updatePreview();
}

function updateGuruData(index) {
  if (index >= guruData.length) {
    guruData[index] = {};
  }
  
  guruData[index] = {
    nama: document.getElementById(`guruNama${index}`)?.value || '',
    mapel: document.getElementById(`guruMapel${index}`)?.value || '',
    kelas: document.getElementById(`guruKelas${index}`)?.value || '',
    jtm: document.getElementById(`guruJtm${index}`)?.value || ''
  };
  updatePreview();
}

function removeGuruRow(index) {
  const row = document.getElementById(`guruRow${index}`);
  if (row) {
    row.remove();
    guruData.splice(index, 1);
    
    const container = document.getElementById('guruTableContainer');
    if (container) {
      container.innerHTML = '';
    }
    
    guruData.forEach((guru, i) => {
      addGuruRow(i);
    });
    
    if (guruData.length === 0) {
      addGuruRow();
    }
  }
  updatePreview();
}

// Fungsi-fungsi untuk SK Panitia
function addPengawasRow(index = null) {
  if (currentJenisSurat !== 'sk_panitia') return;
  
  const container = document.getElementById('pengawasTableContainer');
  if (!container) return;
  
  const rowId = index !== null ? index : pengawasData.length;
  
  const rowHtml = `
    <div class="dynamic-row" id="pengawasRow${rowId}">
      <input type="text" placeholder="Nama Guru" id="pengawasNama${rowId}" value="${pengawasData[rowId]?.nama || ''}" oninput="updatePengawasData(${rowId})">
      <input type="text" placeholder="Jabatan" id="pengawasJabatan${rowId}" value="${pengawasData[rowId]?.jabatan || ''}" oninput="updatePengawasData(${rowId})">
      <button type="button" class="remove-row-btn" onclick="removePengawasRow(${rowId})">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `;
  
  if (index !== null) {
    const existingRow = document.getElementById(`pengawasRow${index}`);
    if (existingRow) {
      existingRow.outerHTML = rowHtml;
    }
  } else {
    container.insertAdjacentHTML('beforeend', rowHtml);
    pengawasData.push({ nama: '', jabatan: '' });
  }
  
  updatePreview();
}

function updatePengawasData(index) {
  if (index >= pengawasData.length) {
    pengawasData[index] = {};
  }
  
  pengawasData[index] = {
    nama: document.getElementById(`pengawasNama${index}`)?.value || '',
    jabatan: document.getElementById(`pengawasJabatan${index}`)?.value || ''
  };
  updatePreview();
}

function removePengawasRow(index) {
  const row = document.getElementById(`pengawasRow${index}`);
  if (row) {
    row.remove();
    pengawasData.splice(index, 1);
    
    const container = document.getElementById('pengawasTableContainer');
    if (container) {
      container.innerHTML = '';
    }
    
    pengawasData.forEach((pengawas, i) => {
      addPengawasRow(i);
    });
    
    if (pengawasData.length === 0) {
      addPengawasRow();
    }
  }
  updatePreview();
}

// Fungsi-fungsi untuk Surat Edaran
function addBiayaRow(index = null) {
  if (currentJenisSurat !== 'surat_edaran') return;
  
  const container = document.getElementById('biayaTableContainer');
  if (!container) return;
  
  const rowId = index !== null ? index : biayaData.length;
  
  const rowHtml = `
    <div class="dynamic-row" id="biayaRow${rowId}">
      <input type="text" placeholder="Rincian Biaya" id="biayaRincian${rowId}" value="${biayaData[rowId]?.rincian || ''}" oninput="updateBiayaData(${rowId})">
      <input type="text" placeholder="Kelas X" id="biayaKelasX${rowId}" value="${biayaData[rowId]?.kelas_x || ''}" oninput="updateBiayaData(${rowId})">
      <input type="text" placeholder="Kelas XI" id="biayaKelasXI${rowId}" value="${biayaData[rowId]?.kelas_xi || ''}" oninput="updateBiayaData(${rowId})">
      <input type="text" placeholder="Kelas XII" id="biayaKelasXII${rowId}" value="${biayaData[rowId]?.kelas_xii || ''}" oninput="updateBiayaData(${rowId})">
      <button type="button" class="remove-row-btn" onclick="removeBiayaRow(${rowId})">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `;
  
  if (index !== null) {
    const existingRow = document.getElementById(`biayaRow${index}`);
    if (existingRow) {
      existingRow.outerHTML = rowHtml;
    }
  } else {
    container.insertAdjacentHTML('beforeend', rowHtml);
    biayaData.push({ rincian: '', kelas_x: '', kelas_xi: '', kelas_xii: '' });
  }
  
  updatePreview();
}

function updateBiayaData(index) {
  if (index >= biayaData.length) {
    biayaData[index] = {};
  }
  
  biayaData[index] = {
    rincian: document.getElementById(`biayaRincian${index}`)?.value || '',
    kelas_x: document.getElementById(`biayaKelasX${index}`)?.value || '',
    kelas_xi: document.getElementById(`biayaKelasXI${index}`)?.value || '',
    kelas_xii: document.getElementById(`biayaKelasXII${index}`)?.value || ''
  };
  updatePreview();
}

function removeBiayaRow(index) {
  const row = document.getElementById(`biayaRow${index}`);
  if (row) {
    row.remove();
    biayaData.splice(index, 1);
    
    const container = document.getElementById('biayaTableContainer');
    if (container) {
      container.innerHTML = '';
    }
    
    biayaData.forEach((biaya, i) => {
      addBiayaRow(i);
    });
    
    if (biayaData.length === 0) {
      addBiayaRow();
    }
  }
  updatePreview();
}

// Fungsi tab navigation
function showTab(tabNumber) {
  if (currentJenisSurat !== 'sk_keputusan') return;
  
  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  const buttons = document.querySelectorAll('.tab-button');
  if (buttons.length >= tabNumber) {
    buttons[tabNumber - 1].classList.add('active');
  }
  
  const tab = document.getElementById(`tab${tabNumber}`);
  if (tab) {
    tab.classList.add('active');
  }
}

function showTabPanitia(tabNumber) {
  if (currentJenisSurat !== 'sk_panitia') return;
  
  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
  
  const buttons = document.querySelectorAll('.tab-button');
  if (buttons.length >= tabNumber) {
    buttons[tabNumber - 1].classList.add('active');
  }
  
  const tab = document.getElementById(`tabPanitia${tabNumber}`);
  if (tab) {
    tab.classList.add('active');
  }
}

function updateSusunanPanitiaPreview() {
  if (currentJenisSurat !== 'sk_panitia') return;
  
  try {
    const ketua = document.getElementById('ketua_panitia')?.value || '-';
    const wakil = document.getElementById('wakil_ketua')?.value || '-';
    const sekretaris = document.getElementById('sekretaris')?.value || '-';
    const bendahara = document.getElementById('bendahara_panitia')?.value || '-';
    const anggota = document.getElementById('anggota_panitia')?.value || '-';
    
    const previewKetua = document.getElementById('previewKetua');
    const previewWakil = document.getElementById('previewWakil');
    const previewSekretaris = document.getElementById('previewSekretaris');
    const previewBendahara = document.getElementById('previewBendahara');
    const previewAnggota = document.getElementById('previewAnggota');
    
    if (previewKetua) previewKetua.textContent = ketua;
    if (previewWakil) previewWakil.textContent = wakil;
    if (previewSekretaris) previewSekretaris.textContent = sekretaris;
    if (previewBendahara) previewBendahara.textContent = bendahara;
    if (previewAnggota) previewAnggota.textContent = anggota;
  } catch (error) {
    console.error('Error updating susunan panitia preview:', error);
  }
}

// Fungsi-fungsi umum
function updateAllPreviews() {
  validateRequiredFields();
  updatePreview();
}

function validateRequiredFields() {
  const requiredFields = ['nama_sekolah', 'kecamatan', 'kabupaten', 'nama_kepala_sekolah', 'tempat_ttd'];
  const yayasanField = document.getElementById('yayasan');
  if (yayasanField && !yayasanField.value.trim()) {
    yayasanField.value = 'YAYASAN ASH SHIDIQI MATARAM BARU';
  }
  
  requiredFields.forEach(fieldId => {
    const input = document.getElementById(fieldId);
    if (input) {
      const formGroup = input.closest('.form-group');
      if (!input.value.trim()) {
        if (formGroup) formGroup.classList.add('has-error');
      } else {
        if (formGroup) formGroup.classList.remove('has-error');
      }
    }
  });
}

// Fungsi cetak dengan konfirmasi
function printDocument() {
  const previews = document.querySelectorAll('.preview');
  if (previews.length === 0) {
    showNotification('Tidak ada preview untuk dicetak! Silakan isi data terlebih dahulu.');
    return;
  }
  
  let isEmpty = false;
  if (currentJenisSurat === 'sk_keputusan') {
    if (!document.getElementById('nomor_surat')?.value || 
        !document.getElementById('tanggal_surat')?.value ||
        !document.getElementById('tahun_pelajaran')?.value) {
      isEmpty = true;
    }
  } else if (currentJenisSurat === 'sk_panitia') {
    if (!document.getElementById('nomor_surat_panitia')?.value || 
        !document.getElementById('tanggal_surat_panitia')?.value ||
        !document.getElementById('nama_kegiatan')?.value ||
        !document.getElementById('tahun_kegiatan')?.value) {
      isEmpty = true;
    }
  } else if (currentJenisSurat === 'surat_edaran') {
    if (!document.getElementById('nomor_edaran')?.value || 
        !document.getElementById('tanggal_edaran')?.value ||
        !document.getElementById('tahun_pelajaran_edaran')?.value ||
        !document.getElementById('tanggal_mulai_pembayaran')?.value ||
        !document.getElementById('tanggal_akhir_pembayaran')?.value ||
        !document.getElementById('metode_pembayaran')?.value) {
      isEmpty = true;
    }
  } else if (currentJenisSurat === 'surat_pemanggilan') {
    if (!document.getElementById('nomor_pemanggilan')?.value || 
        !document.getElementById('tanggal_pemanggilan')?.value ||
        !document.getElementById('nama_siswa')?.value ||
        !document.getElementById('kelas_siswa')?.value ||
        !document.getElementById('hari_tanggal')?.value ||
        !document.getElementById('waktu_pertemuan')?.value ||
        !document.getElementById('tempat_pertemuan')?.value ||
        !document.getElementById('agenda')?.value) {
      isEmpty = true;
    }
  }
  
  if (isEmpty) {
    showNotification('Harap isi semua data yang diperlukan sebelum mencetak!');
    return;
  }
  
  document.getElementById('printModal').style.display = 'flex';
}

function hidePrintModal() {
  document.getElementById('printModal').style.display = 'none';
}

function printAllPreviews(printDirectly = false) {
  hidePrintModal();
  
  const previews = document.querySelectorAll('.preview');
  
  if (previews.length === 0) {
    showNotification('Tidak ada preview untuk dicetak!');
    return;
  }
  
  if (printDirectly) {
    const printWindow = window.open('', '_blank');
    printWindow.document.write('<html><head><title>Cetak Surat - MA Ash-Shidiqi</title>');
    printWindow.document.write('<style>');
    printWindow.document.write(`
      body { margin: 0; padding: 0; font-family: "Times New Roman", Times, serif; }
      .preview { 
        background: #fdfdf8;
        width: 21.59cm;
        min-height: 35.56cm;
        margin: 0 auto;
        padding: 1.5cm 2.5cm 2cm 2.5cm;
        page-break-after: always;
        box-sizing: border-box;
      }
      @media print {
        .preview { margin: 0; }
      }
    `);
    printWindow.document.write('</style></head><body>');
    
    previews.forEach(preview => {
      printWindow.document.write('<div class="preview">');
      printWindow.document.write(preview.querySelector('.paper').innerHTML);
      printWindow.document.write('</div>');
    });
    
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    
    setTimeout(() => {
      printWindow.print();
      printWindow.close();
      showNotification('Mencetak...');
    }, 500);
  }
}

function handleLogoUpload(event) {
  const file = event.target.files[0];
  if (file) {
    if (file.size > 2 * 1024 * 1024) {
      showNotification('Ukuran file maksimal 2MB!');
      return;
    }
    
    if (!file.type.match('image.*')) {
      showNotification('Hanya file gambar yang diperbolehkan!');
      return;
    }
    
    const reader = new FileReader();
    reader.onload = function(e) {
      logoDataUrl = e.target.result;
      const logoPreview = document.getElementById('logoPreview');
      if (logoPreview) {
        logoPreview.innerHTML = `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi" style="width: 100%; height: 100%; object-fit: cover;">`;
      }
      updatePreview();
      showNotification('Logo berhasil diupload!');
    };
    reader.readAsDataURL(file);
  }
}

function removeLogo() {
  logoDataUrl = null;
  const logoPreview = document.getElementById('logoPreview');
  if (logoPreview) {
    logoPreview.innerHTML = '<i class="fas fa-school" style="color: #999;"></i>';
  }
  const logoInput = document.getElementById('logoInput');
  if (logoInput) {
    logoInput.value = '';
  }
  updatePreview();
  showNotification('Logo dihapus');
}

function saveIdentitasSekolah() {
  const requiredFields = ['nama_sekolah', 'kecamatan', 'kabupaten', 'nama_kepala_sekolah', 'tempat_ttd'];
  let isValid = true;
  
  requiredFields.forEach(fieldId => {
    const input = document.getElementById(fieldId);
    if (input) {
      const formGroup = input.closest('.form-group');
      if (!input.value.trim()) {
        if (formGroup) formGroup.classList.add('has-error');
        isValid = false;
      } else {
        if (formGroup) formGroup.classList.remove('has-error');
      }
    }
  });
  
  const yayasanInput = document.getElementById('yayasan');
  if (yayasanInput && !yayasanInput.value.trim()) {
    yayasanInput.value = 'YAYASAN ASH SHIDIQI MATARAM BARU';
  }
  
  if (!isValid) {
    showNotification('Harap isi semua field yang wajib diisi!');
    return;
  }
  
  const data = {
    nama_sekolah: document.getElementById('nama_sekolah').value,
    kecamatan: document.getElementById('kecamatan').value,
    kabupaten: document.getElementById('kabupaten').value,
    yayasan: document.getElementById('yayasan').value || 'YAYASAN ASH SHIDIQI MATARAM BARU',
    alamat_lengkap: document.getElementById('alamat_lengkap')?.value || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199',
    nama_kepala_sekolah: document.getElementById('nama_kepala_sekolah').value,
    tempat_ttd: document.getElementById('tempat_ttd').value,
    nip_kepala_sekolah: document.getElementById('nip_kepala_sekolah')?.value || '',
    logoDataUrl: logoDataUrl
  };
  
  localStorage.setItem(IDENTITAS_KEY, JSON.stringify(data));
  showNotification('Identitas Sekolah berhasil disimpan!');
}

function loadIdentitasSekolah() {
  const saved = localStorage.getItem(IDENTITAS_KEY);
  if (saved) {
    try {
      const data = JSON.parse(saved);
      document.getElementById('nama_sekolah').value = data.nama_sekolah || 'MA. ASH-SHIDIQI RAJABASA BARU';
      document.getElementById('kecamatan').value = data.kecamatan || 'MATARAM BARU';
      document.getElementById('kabupaten').value = data.kabupaten || 'LAMPUNG TIMUR';
      document.getElementById('yayasan').value = data.yayasan || 'YAYASAN ASH SHIDIQI MATARAM BARU';
      
      const alamatLengkap = document.getElementById('alamat_lengkap');
      if (alamatLengkap) {
        alamatLengkap.value = data.alamat_lengkap || 'Sri Rejo Agung, Rajabasa Baru, Kecamatan Mataram Baru, Kabupaten Lampung Timur 34199';
      }
      
      document.getElementById('nama_kepala_sekolah').value = data.nama_kepala_sekolah || '';
      document.getElementById('tempat_ttd').value = data.tempat_ttd || 'Rajabasa Baru';
      
      const nipKepsek = document.getElementById('nip_kepala_sekolah');
      if (nipKepsek) {
        nipKepsek.value = data.nip_kepala_sekolah || '';
      }
      
      if (data.logoDataUrl) {
        logoDataUrl = data.logoDataUrl;
        const logoPreview = document.getElementById('logoPreview');
        if (logoPreview) {
          logoPreview.innerHTML = `<img src="${logoDataUrl}" alt="Logo MA Ash-Shidiqi" style="width: 100%; height: 100%; object-fit: cover;">`;
        }
      }
    } catch (e) {
      console.error('Error loading saved data:', e);
    }
  }
}

function showNotification(message, duration = 3000) {
  const notification = document.createElement('div');
  notification.className = 'notification';
  notification.textContent = message;
  document.body.appendChild(notification);
  
  setTimeout(() => {
    notification.remove();
  }, duration);
}

// Fungsi untuk format tanggal otomatis
function formatDateInputs() {
  const today = new Date();
  const options = { day: 'numeric', month: 'long', year: 'numeric' };
  const tanggalDefault = today.toLocaleDateString('id-ID', options);
  const year = today.getFullYear();
  
  document.querySelectorAll('input[id*="tanggal"]').forEach(input => {
    if (input && !input.value && input.type !== 'hidden' && !input.id.includes('_')) {
      input.value = tanggalDefault;
    }
  });
  
  document.querySelectorAll('input[id*="tahun"]').forEach(input => {
    if (input && !input.value) {
      if (input.id.includes('pelajaran')) {
        input.value = `${year}/${year + 1}`;
      } else if (input.id.includes('kegiatan')) {
        input.value = year.toString();
      }
    }
  });
}

// --- INITIALIZATION ---
document.addEventListener('DOMContentLoaded', function() {
  loadIdentitasSekolah();
  
  const logoInput = document.getElementById('logoInput');
  if (logoInput) {
    logoInput.addEventListener('change', handleLogoUpload);
  }
  
  renderForm();
  updatePreview();
  
  setTimeout(() => {
    formatDateInputs();
    validateRequiredFields();
    updatePreview();
  }, 200);
});

// Event listener untuk update susunan panitia preview
document.addEventListener('input', function(e) {
  if (e.target && 
     (e.target.id === 'ketua_panitia' || 
      e.target.id === 'wakil_ketua' || 
      e.target.id === 'sekretaris' || 
      e.target.id === 'bendahara_panitia' ||
      e.target.id === 'anggota_panitia')) {
    updateSusunanPanitiaPreview();
  }
});

// Event listener untuk validasi real-time
document.addEventListener('blur', function(e) {
  if (e.target && e.target.tagName === 'INPUT' && e.target.hasAttribute('required')) {
    const formGroup = e.target.closest('.form-group');
    if (formGroup) {
      if (!e.target.value.trim()) {
        formGroup.classList.add('has-error');
      } else {
        formGroup.classList.remove('has-error');
      }
    }
  }
}, true);
</script>
</body>
</html>
